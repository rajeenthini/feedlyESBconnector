<template name="getListUnreadCount" xmlns="http://ws.apache.org/ns/synapse">
    <parameter name="autoRefresh" description="auto-refresh this is a background auto-refresh or not." />
    <parameter name="newerThan" description="used as a lower time limit" />
    <parameter name="streamId" description="the unread count response to feeds " />

    <sequence>
        <property name="uri.var.autoRefresh" expression="$func:autoRefresh" />
        <property name="uri.var.newerThan" expression="$func:newerThan" />
        <property name="uri.var.streamId" expression="$func:streamId" />

        <filter
                xpath="get-property('uri.var.autoRefresh') = '' or  (not(string(get-property('uri.var.autoRefresh'))))">
            <then>
                <property name="uri.var.autoRefresh" value="yes" />
            </then>
        </filter>
        <filter
                xpath="get-property('uri.var.newerThan') = '' or  (not(string(get-property('uri.var.newerThan'))))">
            <then>
                <property name="uri.var.newerThan" value="50" />
            </then>
        </filter>
        <filter
                xpath="get-property('uri.var.streamId') = '' or  (not(string(get-property('uri.var.streamId'))))">
            <then>
                <property name="uri.var.streamId" value="en_US" />
            </then>
        </filter>


        <call>
            <endpoint>
                <http method="get"
                      uri-template="https://cloud.feedly.com/v3/markers/counts?autoRefresh={uri.var.autoRefresh}&amp;newerThan={uri.var.newerThan}&amp;streamId={uri.var.streamId}" />
            </endpoint>
        </call>
    </sequence>
</template>